<%= flash[:notice] %>

<div class="main_inner">
  <%= render 'form', :back_text => 'Back', :back_link => toilet_path(@toilet) %>

  <% javascript_tag do %>
    google.load("maps", "2");
    var marker;

    function initialize() {
      var map = new google.maps.Map2(document.getElementById("map"));

      var point = new GLatLng(<%= @toilet.lat%>, <%=@toilet.long%>);
      map.setCenter(point, 15);

      marker = new GMarker(point, {draggable:true});
      marker.setImage();
      map.addOverlay(marker);

      var mapControl = new GMapTypeControl();
      map.addControl(mapControl);
      map.addControl(new GLargeMapControl());

      GEvent.addListener(marker, 'dragend', function() {
        $('#toilet_lat').val(marker.getLatLng().lat());
        $('#toilet_long').val(marker.getLatLng().lng());
      });

    }

    google.setOnLoadCallback(initialize);
  <% end %>
</div>