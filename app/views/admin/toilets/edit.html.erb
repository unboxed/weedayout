<h1>Edit toilet</h1>

<% form_for [:admin, @toilet], :url => {:action => "update"} do |f| %>
    <%= f.error_messages %>
    <%= flash[:notice] %>
    <div class="main_fields">
      <p>
        <%= f.label :name %>
        <%= f.text_field :name %>
      </p>

      <p>
        <%= f.label :address %>
        <%= f.text_field :address %>
      </p>

      <p>
        <%= f.label :venuetype, "Venue Type" %>
        <%= f.text_field :venuetype %>
      </p>

      <p>
        <%= f.label :howtoaccess, "How to access" %>
        <%= f.text_field :howtoaccess %>
      </p>

      <p>
        <%= f.label :changingbench, "Changing Bench?" %>
        <%= f.check_box :changingbench %>
      </p>

      <p>
        <%= f.label :hoist, "Hoist?" %>
        <%= f.check_box :hoist %>
      </p>

      <p>
        <%= f.label :toiletlocation, "Toilet Location" %>
        <%= f.text_field :toiletlocation %>
      </p>

      <p>
        <%= f.label :whocanuse, "Who can use" %>
        <%= f.text_field :whocanuse %>
      </p>

      <div>
        <%= f.label :description, "Description" %>
        <%= f.text_area :description %>
      </div>
    </div>

    <div class="location_selector" style="display:none;">
      <div><label for="MapAddressSearch">Map location</label>
        <input name="MapAddressSearch" id="MapAddressSearch" value="" size="40"/>
        <input type="button" value="Locate on Map" id="locate_on_map"/>
      </div>
      <div id="map" style="height: 500px; width: 500px"></div>
      <div class="field">
        <%= f.label :lat, "Latitude" %>
        <%= f.text_field :lat %>
      </div>
      <div class="field">
        <%= f.label :long, "Longitude" %>
        <%= f.text_field :long %>
      </div>
      <input type="button" value="Update map" id="update_map" class="updatemap" style="display:none"/>
    </div><!-- location_selector -->

    <p>
      <%= f.submit "Submit" %>
    </p>

    <%
       @lat = !f.object.lat.blank? ? "%f" % f.object.lat : 51.5008889524
       @long = !f.object.long.blank? ? "%f" % f.object.long : -0.1220512390
    %>
<% end %>

<!-- Google maps-->
<script type="text/javascript"
	src="http://www.google.com/jsapi?key=ABQIAAAAlyeJljQH98VMTkAORPPxhxRi_j0U6kJrkFvY4-OX2XYmEAa76BR1dkIiZ5uJBrN49TH92bIh5AJW7w">
</script>
<script type="text/javascript">
	google.load("maps", "2");
	
function initialize() {
	var map = new google.maps.Map2(document.getElementById("map"));
	
	var point = new GLatLng(<%= @toilet.lat%>, <%=@toilet.long%>);
	map.setCenter(point, 15);
	
	var index = <%= @display_index %>;
	var letter = String.fromCharCode("A".charCodeAt(0) + (index - 1));
	var myIcon = new GIcon(G_DEFAULT_ICON, "http://www.google.com/mapfiles/marker" + letter + ".png");
	
	var marker = new GMarker(point, {draggable:false, icon:myIcon});
	marker.setImage();
	map.addOverlay(marker);
	
  	var mapControl = new GMapTypeControl();
  	map.addControl(mapControl);
  	map.addControl(new GLargeMapControl());
}

    google.setOnLoadCallback(initialize);		
</script>
